<%- include('partials/header', { bruger, currentPage: 'dashboard', title: 'Dashboard' }) %>

  <!-- Hero Section -->
  <section class="relative text-white min-h-[70vh] flex items-center overflow-hidden" style="background-image: url('/images/hero/theater-1713815_1280.webp'); background-size: cover; background-position: center; background-repeat: no-repeat; margin-top: -80px; padding-top: 80px;">
    <!-- Dark overlay for better text readability -->
    <div class="absolute inset-0 bg-black bg-opacity-60"></div>
    
    <div class="content-container py-20 relative z-20">
      <div class="text-center">
        <h2 class="text-5xl font-bold text-gold mb-4 drop-shadow-2xl">Velkommen, <%= bruger.navn %>! 🎭</h2>
        <p class="text-2xl text-cream drop-shadow-lg">Din personlige scene til at administrere rekvisitter</p>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="py-12 bg-cream">
    <div class="content-container">
      <!-- Quick Actions -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
        <a href="/opret-produkt" class="block bg-gradient-to-br from-burgundy to-gray-900 text-white p-8 rounded-lg shadow-lg hover:shadow-2xl transition transform hover:scale-105">
          <div class="text-5xl mb-4">➕</div>
          <h3 class="text-2xl font-bold mb-2">Opret Produkt</h3>
          <p class="text-cream">Tilføj en ny rekvisit til kollektionen</p>
        </a>

        <a href="/browse" class="block bg-gradient-to-br from-blue-600 to-blue-800 text-white p-8 rounded-lg shadow-lg hover:shadow-2xl transition transform hover:scale-105">
          <div class="text-5xl mb-4">🔍</div>
          <h3 class="text-2xl font-bold mb-2">Browse Rekvisitter</h3>
          <p class="text-cream">Se andre teatres rekvisitter</p>
        </a>

        <a href="/favoritter" class="block bg-gradient-to-br from-red-500 to-pink-600 text-white p-8 rounded-lg shadow-lg hover:shadow-2xl transition transform hover:scale-105">
          <div class="text-5xl mb-4">❤️</div>
          <h3 class="text-2xl font-bold mb-2">Mine Favoritter</h3>
          <p class="text-cream">Dine favoriserede rekvisitter</p>
        </a>

        <a href="/forestillingsperioder" class="block bg-gradient-to-br from-green-600 to-teal-700 text-white p-8 rounded-lg shadow-lg hover:shadow-2xl transition transform hover:scale-105">
          <div class="text-5xl mb-4">📅</div>
          <h3 class="text-2xl font-bold mb-2">Forestillinger</h3>
          <p class="text-cream">Administrer dine perioder</p>
        </a>

        <a href="/tilkoeb" class="block bg-gradient-to-br from-orange-500 to-amber-600 text-white p-8 rounded-lg shadow-lg hover:shadow-2xl transition transform hover:scale-105">
          <div class="text-5xl mb-4">📦</div>
          <h3 class="text-2xl font-bold mb-2">Tilkøb & Services</h3>
          <p class="text-cream">Transport og forsikring</p>
        </a>

        <a href="/konsultation" class="block bg-gradient-to-br from-purple-600 to-indigo-700 text-white p-8 rounded-lg shadow-lg hover:shadow-2xl transition transform hover:scale-105">
          <div class="text-5xl mb-4">💼</div>
          <h3 class="text-2xl font-bold mb-2">Book Konsultation</h3>
          <p class="text-cream">Få hjælp til at finde rekvisitter</p>
        </a>
      </div>

      <!-- Points Display Card -->
      <div class="bg-gradient-to-br from-gold to-amber-500 rounded-lg shadow-2xl p-8 mb-8 border-4 border-burgundy">
        <div class="text-gray-900">
          <h3 class="text-3xl font-bold mb-3">Optjen Points!</h3>
          <p class="mb-6 text-lg leading-relaxed">Jo mere aktivt du deltager i fællesskabet, jo flere points optjener du. Brug points til rabatter og specielle fordele.</p>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Points Badge -->
            <div class="bg-white rounded-lg p-6 shadow-lg flex flex-col items-center justify-center">
              <div class="text-sm font-semibold text-gray-600 mb-2">Dine Points</div>
              <div class="text-6xl mb-2">⭐</div>
              <div class="text-5xl font-bold text-burgundy"><%= bruger.points || 0 %></div>
            </div>

            <!-- Explanation Box -->
            <div class="md:col-span-2 bg-white/80 rounded-lg p-6">
              <h4 class="font-bold mb-4 text-burgundy text-xl">💰 Sådan optjener du points:</h4>
              <div class="grid grid-cols-2 gap-4">
                <div class="flex items-center">
                  <span class="text-burgundy font-bold mr-2">+10</span>
                  <span>Opret produkt</span>
                </div>
                <div class="flex items-center">
                  <span class="text-burgundy font-bold mr-2">+25</span>
                  <span>Udlej produkt</span>
                </div>
                <div class="flex items-center">
                  <span class="text-burgundy font-bold mr-2">+50</span>
                  <span>Gennemført leje</span>
                </div>
                <div class="flex items-center">
                  <span class="text-burgundy font-bold mr-2">+100</span>
                  <span>5-stjernet anmeldelse</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Planlagte/Bestilte Produkter Section -->
      <% if (reservationer && reservationer.length > 0) { %>
      <div class="bg-white rounded-lg shadow-xl p-8 border-2 border-gold mb-8">
        <h3 class="text-3xl font-bold text-burgundy mb-6">📦 Planlagte/Bestilte Produkter</h3>
        <p class="text-gray-700 mb-6">Dine rekvisitter som er bestilt og skal hentes</p>
        
        <div class="space-y-4">
          <% reservationer.forEach(reservation => { 
            const fraDato = new Date(reservation.fra_dato);
            const tilDato = new Date(reservation.til_dato);
            const erAktiv = new Date() >= fraDato && new Date() <= tilDato;
            const erKommende = new Date() < fraDato;
          %>
            <div class="border-2 <%= erAktiv ? 'border-green-500 bg-green-50' : erKommende ? 'border-blue-500 bg-blue-50' : 'border-gray-300 bg-gray-50' %> rounded-lg p-6">
              <div class="flex flex-col md:flex-row gap-4">
                <!-- Produkt billede -->
                <% if (reservation.produkt_billede) { %>
                  <img src="<%= reservation.produkt_billede %>" alt="<%= reservation.produkt_navn %>" 
                       class="w-32 h-32 object-cover rounded-lg">
                <% } else { %>
                  <div class="w-32 h-32 bg-gray-200 rounded-lg flex items-center justify-center text-4xl">
                    🎭
                  </div>
                <% } %>
                
                <!-- Reservation info -->
                <div class="flex-grow">
                  <div class="flex items-start justify-between mb-2">
                    <h4 class="text-xl font-bold text-burgundy"><%= reservation.produkt_navn %></h4>
                    <span class="px-3 py-1 rounded-full text-sm font-semibold 
                           <%= erAktiv ? 'bg-green-600 text-white' : erKommende ? 'bg-blue-600 text-white' : 'bg-gray-600 text-white' %>">
                      <%= erAktiv ? 'Aktiv leje' : erKommende ? 'Kommende' : 'Afsluttet' %>
                    </span>
                  </div>
                  
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                    <div>
                      <p class="font-semibold text-gray-900">Lejer:</p>
                      <p><%= reservation.lejer_teaternavn || 'Ukendt teater' %></p>
                      <p class="text-sm text-gray-600"><%= reservation.bruger %></p>
                    </div>
                    
                    <div>
                      <p class="font-semibold text-gray-900">Lejeperiode:</p>
                      <p class="text-sm">
                        <strong>Fra:</strong> <%= fraDato.toLocaleDateString('da-DK') %><br>
                        <strong>Til:</strong> <%= tilDato.toLocaleDateString('da-DK') %>
                      </p>
                      <p class="text-xs text-gray-600 mt-1">
                        <%= Math.ceil((tilDato - fraDato) / (1000 * 60 * 60 * 24)) %> dage
                      </p>
                    </div>
                  </div>
                  
                  <% if (erKommende) { 
                    const dageInd = Math.ceil((fraDato - new Date()) / (1000 * 60 * 60 * 24));
                  %>
                    <div class="mt-3 p-3 bg-blue-100 border border-blue-300 rounded">
                      <p class="text-sm font-semibold text-blue-900">
                        🗓️ Skal hentes om <%= dageInd %> dag<%= dageInd !== 1 ? 'e' : '' %>
                      </p>
                    </div>
                  <% } %>
                  
                  <% if (erAktiv) { %>
                    <div class="mt-3 p-3 bg-green-100 border border-green-300 rounded">
                      <p class="text-sm font-semibold text-green-900">
                        ✓ Produktet er pt. udlejet
                      </p>
                    </div>
                  <% } %>
                </div>
              </div>
              
              <!-- Lokation info -->
              <div class="mt-4 p-3 bg-yellow-50 border border-yellow-300 rounded">
                <p class="text-sm text-gray-700">
                  <strong>📍 Hvor står produktet:</strong> <%= bruger.teaternavn %>, <%= bruger.lokation || 'Lokation ikke angivet' %>
                </p>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
      <% } %>

      <!-- Mine Reservationer (Produkter jeg har lejet) -->
      <% if (mineReservationer && mineReservationer.length > 0) { %>
      <div class="bg-white rounded-lg shadow-xl p-8 border-2 border-blue-500 mb-8">
        <h3 class="text-3xl font-bold text-blue-700 mb-6">🎯 Produkter Jeg Har Reserveret</h3>
        <p class="text-gray-700 mb-6">Rekvisitter du har lejet fra andre teatre</p>
        
        <div class="space-y-4">
          <% mineReservationer.forEach(reservation => { 
            const fraDato = new Date(reservation.fra_dato);
            const tilDato = new Date(reservation.til_dato);
            const idag = new Date();
            idag.setHours(0, 0, 0, 0);
            const erAktiv = idag >= fraDato && idag <= tilDato;
            const erKommende = idag < fraDato;
            const dageBack = Math.ceil((tilDato - idag) / (1000 * 60 * 60 * 24));
            const snartAflevering = erAktiv && dageBack <= 3;
          %>
            <div class="border-2 <%= erAktiv ? (snartAflevering ? 'border-orange-500 bg-orange-50' : 'border-green-500 bg-green-50') : erKommende ? 'border-blue-500 bg-blue-50' : 'border-gray-300 bg-gray-50' %> rounded-lg p-6">
              <div class="flex flex-col md:flex-row gap-4">
                <!-- Produkt billede -->
                <% if (reservation.produkt_billede) { %>
                  <img src="<%= reservation.produkt_billede %>" alt="<%= reservation.produkt_navn %>" 
                       class="w-32 h-32 object-cover rounded-lg">
                <% } else { %>
                  <div class="w-32 h-32 bg-gray-200 rounded-lg flex items-center justify-center text-4xl">
                    🎭
                  </div>
                <% } %>
                
                <!-- Reservation info -->
                <div class="flex-grow">
                  <div class="flex items-start justify-between mb-2">
                    <h4 class="text-xl font-bold text-burgundy"><%= reservation.produkt_navn %></h4>
                    <span class="px-3 py-1 rounded-full text-sm font-semibold 
                           <%= erAktiv ? (snartAflevering ? 'bg-orange-600 text-white' : 'bg-green-600 text-white') : erKommende ? 'bg-blue-600 text-white' : 'bg-gray-600 text-white' %>">
                      <%= erAktiv ? (snartAflevering ? '⚠️ Snart aflever' : 'Aktiv leje') : erKommende ? 'Kommende' : 'Afsluttet' %>
                    </span>
                  </div>
                  
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                    <div>
                      <p class="font-semibold text-gray-900">Ejer:</p>
                      <p><%= reservation.ejer_teaternavn %></p>
                      <% if (reservation.ejer_lokation) { %>
                        <p class="text-sm text-gray-600">📍 <%= reservation.ejer_lokation %></p>
                      <% } %>
                    </div>
                    
                    <div>
                      <p class="font-semibold text-gray-900">Lejeperiode:</p>
                      <p class="text-sm">
                        <strong>Fra:</strong> <%= fraDato.toLocaleDateString('da-DK') %><br>
                        <strong>Til:</strong> <%= tilDato.toLocaleDateString('da-DK') %>
                      </p>
                      <p class="text-xs text-gray-600 mt-1">
                        <%= Math.ceil((tilDato - fraDato) / (1000 * 60 * 60 * 24)) %> dage
                      </p>
                    </div>
                  </div>
                  
                  <% if (erAktiv) { %>
                    <% if (snartAflevering) { %>
                      <div class="mt-3 p-3 bg-orange-100 border-2 border-orange-400 rounded">
                        <p class="text-sm font-bold text-orange-900">
                          ⚠️ VIGTIGT: Skal afleveres om <%= dageBack %> dag<%= dageBack !== 1 ? 'e' : '' %>!
                        </p>
                        <p class="text-xs text-orange-700 mt-1">
                          Husk at returnere produktet i samme stand
                        </p>
                      </div>
                    <% } else { %>
                      <div class="mt-3 p-3 bg-green-100 border border-green-300 rounded">
                        <p class="text-sm font-semibold text-green-900">
                          ✓ Du har produktet pt. • Skal afleveres om <%= dageBack %> dag<%= dageBack !== 1 ? 'e' : '' %>
                        </p>
                      </div>
                    <% } %>
                  <% } %>
                  
                  <% if (erKommende) { 
                    const dageInd = Math.ceil((fraDato - idag) / (1000 * 60 * 60 * 24));
                  %>
                    <div class="mt-3 p-3 bg-blue-100 border border-blue-300 rounded">
                      <p class="text-sm font-semibold text-blue-900">
                        📅 Klar til afhentning om <%= dageInd %> dag<%= dageInd !== 1 ? 'e' : '' %>
                      </p>
                    </div>
                  <% } %>
                </div>
              </div>
              
              <!-- Afleveringssted -->
              <div class="mt-4 p-3 bg-yellow-50 border border-yellow-300 rounded">
                <p class="text-sm text-gray-700">
                  <strong>📍 Afleveringssted:</strong> <%= reservation.ejer_teaternavn %><%= reservation.ejer_lokation ? ', ' + reservation.ejer_lokation : '' %>
                  <% if (reservation.produkt_lokation) { %>
                    <span class="ml-2 text-xs bg-yellow-200 px-2 py-1 rounded"><%= reservation.produkt_lokation %></span>
                  <% } %>
                </p>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
      <% } %>

      <!-- Product Overview -->
      <div class="bg-white rounded-lg shadow-xl p-8 border-2 border-gold">
        <h3 class="text-3xl font-bold text-burgundy mb-6">Mine Rekvisitter</h3>
        <div class="mt-8 mb-6 p-4 bg-blue-50 border border-blue-200 rounded">
            <p class="text-sm text-gray-700">
              <strong>💡 Tip:</strong> Skjul dine rekvisitter hvis de ikke er tilgængelige eller gået i stykker
            </p>
          </div>
        
        <% if (produkter.length === 0) { %>
          <div class="text-center py-12">
            <p class="text-xl text-gray-600 mb-4">Du har ikke oprettet nogle rekvisitter endnu.</p>
            <a href="/opret-produkt" class="inline-block bg-burgundy text-cream px-6 py-3 rounded-lg font-bold hover:bg-opacity-90 transition">
              Opret din første rekvisit
            </a>
          </div>
        <% } else { %>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <% produkter.forEach(produkt => { %>
              <div class="bg-gradient-to-br from-cream to-white rounded-lg border-2 border-gold p-6 shadow-lg">
                <h4 class="text-xl font-bold text-burgundy mb-2"><%= produkt.navn %></h4>
                <p class="text-gray-700 mb-3 line-clamp-2"><%= produkt.beskrivelse %></p>
                
                <% if (produkt.lokation) { %>
                  <p class="text-base font-semibold text-burgundy mb-4">📍 <%= produkt.lokation %></p>
                <% } %>
                
                <div class="flex items-center justify-between mb-4">
                  <span class="text-sm <%= produkt.skjult ? 'text-orange-600' : 'text-green-600' %> font-semibold">
                    <%= produkt.skjult ? '🔒 Skjult for andre' : '👁️ Synlig for alle' %>
                  </span>
                  <span class="text-sm text-gray-600">
                    <%= produkt.reservationer.length %> reservationer
                  </span>
                </div>
                
                <div class="flex gap-2">
                  <a href="/produkt/<%= produkt.id %>" class="flex-1 text-center bg-burgundy text-cream py-2 px-4 rounded font-semibold hover:bg-opacity-90 transition">
                    Se detaljer
                  </a>
                  <form action="/produkt/<%= produkt.id %>/skjul" method="POST" class="flex-1">
                    <button type="submit" class="w-full bg-gold text-gray-900 py-2 px-4 rounded font-semibold hover:bg-opacity-90 transition">
                      <%= produkt.skjult ? 'Vis' : 'Skjul' %>
                    </button>
                  </form>
                </div>
              </div>
            <% }); %>
          </div>
        
        <% } %>
      </div>
    </div>
  </main>

<%- include('partials/footer', { bruger }) %>
